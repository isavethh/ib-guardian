<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç NEO Guardian - Visualizaci√≥n 3D del Sistema Solar</title>
    
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif;
            background: #000;
            overflow: hidden;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .ui-overlay {
            position: fixed;
            z-index: 100;
            pointer-events: none;
        }
        .ui-overlay > * {
            pointer-events: auto;
        }
        .glass {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .neo-marker {
            position: absolute;
            transform: translate(-50%, -50%);
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.3s;
        }
        .neo-marker:hover {
            transform: translate(-50%, -50%) scale(1.5);
        }
        .neo-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .neo-safe { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .neo-hazardous { background: #ef4444; box-shadow: 0 0 15px #ef4444; }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(99, 102, 241, 0.5);
            border-radius: 8px;
            padding: 12px;
            min-width: 200px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip.visible { opacity: 1; }
    </style>
</head>
<body>
    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>
    
    <!-- Header UI -->
    <div class="ui-overlay top-0 left-0 right-0 p-4">
        <div class="glass rounded-xl p-4 mx-auto max-w-4xl flex items-center justify-between">
            <div class="flex items-center gap-3">
                <a href="/static/index.html" class="text-2xl hover:scale-110 transition">üöÄ</a>
                <div>
                    <h1 class="text-white text-xl font-bold">NEO Guardian 3D</h1>
                    <p class="text-gray-400 text-sm">Sistema Solar Interactivo</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <p class="text-gray-400 text-xs">NEOs Activos</p>
                    <p id="neo-count" class="text-white font-bold">--</p>
                </div>
                <div class="text-right">
                    <p class="text-gray-400 text-xs">Peligrosos</p>
                    <p id="hazardous-count" class="text-red-400 font-bold">--</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Controls Panel -->
    <div class="ui-overlay top-24 left-4 w-72">
        <div class="glass rounded-xl p-4 text-white">
            <h3 class="font-bold mb-3 flex items-center gap-2">
                <span>üéÆ</span> Controles
            </h3>
            
            <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-400">Rotar</span>
                    <span>Click + Arrastrar</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Zoom</span>
                    <span>Scroll</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Mover</span>
                    <span>Click derecho + Arrastrar</span>
                </div>
            </div>
            
            <hr class="border-white/10 my-4">
            
            <h4 class="font-semibold mb-2">Velocidad de Tiempo</h4>
            <div class="flex items-center gap-2">
                <button onclick="setTimeSpeed(0)" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">‚è∏Ô∏è</button>
                <button onclick="setTimeSpeed(1)" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">1x</button>
                <button onclick="setTimeSpeed(10)" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">10x</button>
                <button onclick="setTimeSpeed(100)" class="px-3 py-1 rounded bg-white/10 hover:bg-white/20">100x</button>
            </div>
            
            <hr class="border-white/10 my-4">
            
            <h4 class="font-semibold mb-2">Vista</h4>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="focusOn('earth')" class="px-3 py-2 rounded bg-blue-600/30 hover:bg-blue-600/50 text-sm">
                    üåç Tierra
                </button>
                <button onclick="focusOn('sun')" class="px-3 py-2 rounded bg-yellow-600/30 hover:bg-yellow-600/50 text-sm">
                    ‚òÄÔ∏è Sol
                </button>
                <button onclick="focusOn('mars')" class="px-3 py-2 rounded bg-red-600/30 hover:bg-red-600/50 text-sm">
                    üî¥ Marte
                </button>
                <button onclick="resetView()" class="px-3 py-2 rounded bg-white/10 hover:bg-white/20 text-sm">
                    üîÑ Reset
                </button>
            </div>
            
            <hr class="border-white/10 my-4">
            
            <h4 class="font-semibold mb-2">Mostrar</h4>
            <div class="space-y-2">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="show-orbits" checked onchange="toggleOrbits()" class="rounded">
                    <span class="text-sm">√ìrbitas de planetas</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="show-neo-orbits" checked onchange="toggleNEOOrbits()" class="rounded">
                    <span class="text-sm">√ìrbitas de NEOs</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="show-labels" checked onchange="toggleLabels()" class="rounded">
                    <span class="text-sm">Etiquetas</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- NEO Info Panel -->
    <div class="ui-overlay top-24 right-4 w-80">
        <div id="neo-info-panel" class="glass rounded-xl p-4 text-white hidden">
            <div class="flex items-center justify-between mb-3">
                <h3 id="neo-info-name" class="font-bold">Asteroide</h3>
                <button onclick="closeNEOPanel()" class="text-gray-400 hover:text-white">‚úï</button>
            </div>
            
            <div id="neo-info-hazard" class="mb-3 px-3 py-1 rounded-full text-center text-sm"></div>
            
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-gray-400">Di√°metro</span>
                    <span id="neo-info-diameter">--</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Velocidad</span>
                    <span id="neo-info-velocity">--</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Distancia</span>
                    <span id="neo-info-distance">--</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-400">Pr√≥ximo acercamiento</span>
                    <span id="neo-info-approach">--</span>
                </div>
            </div>
            
            <button onclick="simulateNEOImpact()" class="mt-4 w-full py-2 rounded-lg bg-red-600 hover:bg-red-700 transition">
                üí• Simular Impacto
            </button>
        </div>
    </div>
    
    <!-- Legend -->
    <div class="ui-overlay bottom-4 left-4">
        <div class="glass rounded-xl p-4 text-white">
            <h4 class="font-semibold mb-2 text-sm">Leyenda</h4>
            <div class="space-y-2 text-xs">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <span>NEO Seguro</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <span>NEO Potencialmente Peligroso</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <span>Sol</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                    <span>Tierra</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Date Display -->
    <div class="ui-overlay bottom-4 right-4">
        <div class="glass rounded-xl px-6 py-3 text-white text-center">
            <p class="text-gray-400 text-xs">Fecha Simulada</p>
            <p id="sim-date" class="text-lg font-mono">--</p>
        </div>
    </div>
    
    <!-- Tooltip -->
    <div id="tooltip" class="tooltip text-white text-sm"></div>

    <script>
        // =====================================================
        // NEO Guardian - Sistema Solar 3D con Three.js
        // =====================================================
        
        let scene, camera, renderer, controls;
        let sun, earth, mars, mercury, venus;
        let earthOrbit, marsOrbit, venusOrbit, mercuryOrbit;
        let neoObjects = [];
        let neoOrbits = [];
        let labels = [];
        let timeSpeed = 1;
        let simulationTime = Date.now();
        
        const API_BASE = 'http://localhost:8000/api/v1';
        const AU = 100; // 1 Unidad Astron√≥mica = 100 unidades en la escena
        const SCALE = {
            sun: 10,
            mercury: 0.8,
            venus: 1.5,
            earth: 1.6,
            mars: 1.2,
            neo: 0.3
        };
        
        // Colores
        const COLORS = {
            sun: 0xffdd00,
            mercury: 0x8c8c8c,
            venus: 0xe6c86e,
            earth: 0x2266ff,
            earthLand: 0x22aa22,
            mars: 0xdd4422,
            neoSafe: 0x10b981,
            neoHazardous: 0xef4444,
            orbit: 0x444466
        };
        
        // Datos orbitales (simplificados)
        const ORBITS = {
            mercury: { radius: 0.39 * AU, period: 88, inclination: 7 },
            venus: { radius: 0.72 * AU, period: 225, inclination: 3.4 },
            earth: { radius: 1.0 * AU, period: 365, inclination: 0 },
            mars: { radius: 1.52 * AU, period: 687, inclination: 1.85 }
        };
        
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);
            
            // Camera
            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                0.1,
                10000
            );
            camera.position.set(0, 150, 250);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 20;
            controls.maxDistance = 1000;
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
            sunLight.position.set(0, 0, 0);
            scene.add(sunLight);
            
            // Create celestial bodies
            createSun();
            createPlanets();
            createStarfield();
            createOrbits();
            
            // Load NEO data
            loadNEOData();
            
            // Handle resize
            window.addEventListener('resize', onWindowResize);
            
            // Start animation
            animate();
        }
        
        function createSun() {
            const geometry = new THREE.SphereGeometry(SCALE.sun, 32, 32);
            const material = new THREE.MeshBasicMaterial({
                color: COLORS.sun,
                emissive: COLORS.sun,
                emissiveIntensity: 1
            });
            sun = new THREE.Mesh(geometry, material);
            sun.name = 'sun';
            scene.add(sun);
            
            // Sun glow
            const glowGeometry = new THREE.SphereGeometry(SCALE.sun * 1.2, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: COLORS.sun,
                transparent: true,
                opacity: 0.3
            });
            const sunGlow = new THREE.Mesh(glowGeometry, glowMaterial);
            sun.add(sunGlow);
        }
        
        function createPlanets() {
            // Mercury
            mercury = createPlanet(SCALE.mercury, COLORS.mercury, 'Mercury');
            mercury.userData.orbit = ORBITS.mercury;
            scene.add(mercury);
            
            // Venus
            venus = createPlanet(SCALE.venus, COLORS.venus, 'Venus');
            venus.userData.orbit = ORBITS.venus;
            scene.add(venus);
            
            // Earth
            earth = createPlanet(SCALE.earth, COLORS.earth, 'Earth');
            earth.userData.orbit = ORBITS.earth;
            scene.add(earth);
            
            // Add moon to Earth
            const moon = createPlanet(0.3, 0xaaaaaa, 'Moon');
            moon.position.set(3, 0, 0);
            earth.add(moon);
            
            // Mars
            mars = createPlanet(SCALE.mars, COLORS.mars, 'Mars');
            mars.userData.orbit = ORBITS.mars;
            scene.add(mars);
        }
        
        function createPlanet(size, color, name) {
            const geometry = new THREE.SphereGeometry(size, 32, 32);
            const material = new THREE.MeshPhongMaterial({
                color: color,
                shininess: 10
            });
            const planet = new THREE.Mesh(geometry, material);
            planet.name = name;
            planet.castShadow = true;
            planet.receiveShadow = true;
            return planet;
        }
        
        function createOrbits() {
            // Planet orbits
            [ORBITS.mercury, ORBITS.venus, ORBITS.earth, ORBITS.mars].forEach((orbit, i) => {
                const curve = new THREE.EllipseCurve(
                    0, 0,
                    orbit.radius, orbit.radius,
                    0, 2 * Math.PI,
                    false,
                    0
                );
                
                const points = curve.getPoints(100);
                const geometry = new THREE.BufferGeometry().setFromPoints(
                    points.map(p => new THREE.Vector3(p.x, 0, p.y))
                );
                
                const material = new THREE.LineBasicMaterial({
                    color: COLORS.orbit,
                    transparent: true,
                    opacity: 0.5
                });
                
                const orbitLine = new THREE.Line(geometry, material);
                orbitLine.rotation.x = THREE.MathUtils.degToRad(orbit.inclination);
                scene.add(orbitLine);
                
                if (i === 0) mercuryOrbit = orbitLine;
                if (i === 1) venusOrbit = orbitLine;
                if (i === 2) earthOrbit = orbitLine;
                if (i === 3) marsOrbit = orbitLine;
            });
        }
        
        function createStarfield() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 4000;
                const y = (Math.random() - 0.5) * 4000;
                const z = (Math.random() - 0.5) * 4000;
                vertices.push(x, y, z);
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            
            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7,
                transparent: true,
                opacity: 0.8
            });
            
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        
        function createNEO(data) {
            const isHazardous = data.is_potentially_hazardous;
            const size = Math.max(0.2, Math.min(2, (data.estimated_diameter_max_km || 0.1) * 2));
            
            const geometry = new THREE.SphereGeometry(size, 16, 16);
            const material = new THREE.MeshPhongMaterial({
                color: isHazardous ? COLORS.neoHazardous : COLORS.neoSafe,
                emissive: isHazardous ? COLORS.neoHazardous : COLORS.neoSafe,
                emissiveIntensity: 0.3
            });
            
            const neo = new THREE.Mesh(geometry, material);
            neo.name = data.name;
            neo.userData = data;
            
            // Random orbit for visualization (simplified)
            const orbitRadius = 0.8 + Math.random() * 0.8; // Between 0.8 and 1.6 AU
            const orbitAngle = Math.random() * Math.PI * 2;
            const inclination = (Math.random() - 0.5) * 20;
            
            neo.userData.orbitRadius = orbitRadius * AU;
            neo.userData.orbitAngle = orbitAngle;
            neo.userData.inclination = inclination;
            neo.userData.orbitSpeed = 0.01 + Math.random() * 0.02;
            
            // Create NEO orbit
            if (document.getElementById('show-neo-orbits').checked) {
                const orbitCurve = new THREE.EllipseCurve(
                    0, 0,
                    orbitRadius * AU, orbitRadius * AU * (0.7 + Math.random() * 0.3),
                    0, 2 * Math.PI,
                    false,
                    0
                );
                
                const orbitPoints = orbitCurve.getPoints(50);
                const orbitGeometry = new THREE.BufferGeometry().setFromPoints(
                    orbitPoints.map(p => new THREE.Vector3(p.x, 0, p.y))
                );
                
                const orbitMaterial = new THREE.LineBasicMaterial({
                    color: isHazardous ? COLORS.neoHazardous : COLORS.neoSafe,
                    transparent: true,
                    opacity: 0.2
                });
                
                const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
                orbitLine.rotation.x = THREE.MathUtils.degToRad(inclination);
                scene.add(orbitLine);
                neoOrbits.push(orbitLine);
            }
            
            scene.add(neo);
            neoObjects.push(neo);
            
            return neo;
        }
        
        async function loadNEOData() {
            try {
                const response = await fetch(`${API_BASE}/neo/today`);
                if (!response.ok) throw new Error('API Error');
                
                const stats = await response.json();
                document.getElementById('neo-count').textContent = stats.total_count;
                document.getElementById('hazardous-count').textContent = stats.hazardous_count;
                
                // Try to get full feed with auth token
                const token = localStorage.getItem('neo_guardian_token');
                if (token) {
                    const feedResponse = await fetch(`${API_BASE}/neo/feed?days=7`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    if (feedResponse.ok) {
                        const feedData = await feedResponse.json();
                        feedData.neos.forEach(neo => createNEO(neo));
                    }
                } else {
                    // Create some demo NEOs
                    for (let i = 0; i < 15; i++) {
                        createNEO({
                            name: `NEO-${2024 + i}`,
                            neo_id: `demo_${i}`,
                            is_potentially_hazardous: Math.random() > 0.7,
                            estimated_diameter_min_km: 0.05 + Math.random() * 0.5,
                            estimated_diameter_max_km: 0.1 + Math.random() * 0.8,
                            close_approaches: [{
                                distance_km: 1000000 + Math.random() * 50000000,
                                velocity_kmh: 20000 + Math.random() * 80000
                            }]
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading NEO data:', error);
                // Create demo NEOs on error
                for (let i = 0; i < 10; i++) {
                    createNEO({
                        name: `Demo-NEO-${i}`,
                        neo_id: `demo_${i}`,
                        is_potentially_hazardous: i < 3,
                        estimated_diameter_min_km: 0.1,
                        estimated_diameter_max_km: 0.5
                    });
                }
            }
        }
        
        function updatePlanetPositions(time) {
            const daysSinceEpoch = time / (1000 * 60 * 60 * 24);
            
            [
                { planet: mercury, orbit: ORBITS.mercury },
                { planet: venus, orbit: ORBITS.venus },
                { planet: earth, orbit: ORBITS.earth },
                { planet: mars, orbit: ORBITS.mars }
            ].forEach(({ planet, orbit }) => {
                const angle = (daysSinceEpoch / orbit.period) * Math.PI * 2;
                planet.position.x = Math.cos(angle) * orbit.radius;
                planet.position.z = Math.sin(angle) * orbit.radius;
                planet.position.y = Math.sin(angle) * Math.tan(THREE.MathUtils.degToRad(orbit.inclination)) * orbit.radius * 0.1;
                
                // Rotation
                planet.rotation.y += 0.01;
            });
        }
        
        function updateNEOPositions(time) {
            const daysSinceEpoch = time / (1000 * 60 * 60 * 24);
            
            neoObjects.forEach(neo => {
                const angle = neo.userData.orbitAngle + (daysSinceEpoch * neo.userData.orbitSpeed);
                const radius = neo.userData.orbitRadius;
                const inclination = neo.userData.inclination;
                
                neo.position.x = Math.cos(angle) * radius;
                neo.position.z = Math.sin(angle) * radius;
                neo.position.y = Math.sin(angle) * Math.tan(THREE.MathUtils.degToRad(inclination)) * radius * 0.1;
            });
        }
        
        function updateSimulationDate() {
            const date = new Date(simulationTime);
            document.getElementById('sim-date').textContent = date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Update time
            simulationTime += timeSpeed * 1000 * 60 * 60; // Speed in hours
            
            // Update positions
            updatePlanetPositions(simulationTime);
            updateNEOPositions(simulationTime);
            updateSimulationDate();
            
            // Sun pulsing
            sun.scale.setScalar(1 + Math.sin(Date.now() * 0.001) * 0.02);
            
            controls.update();
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Control functions
        function setTimeSpeed(speed) {
            timeSpeed = speed;
        }
        
        function focusOn(target) {
            let targetObj;
            switch (target) {
                case 'sun': targetObj = sun; break;
                case 'earth': targetObj = earth; break;
                case 'mars': targetObj = mars; break;
            }
            
            if (targetObj) {
                controls.target.copy(targetObj.position);
                camera.position.set(
                    targetObj.position.x + 50,
                    targetObj.position.y + 30,
                    targetObj.position.z + 50
                );
            }
        }
        
        function resetView() {
            camera.position.set(0, 150, 250);
            controls.target.set(0, 0, 0);
        }
        
        function toggleOrbits() {
            const show = document.getElementById('show-orbits').checked;
            [mercuryOrbit, venusOrbit, earthOrbit, marsOrbit].forEach(orbit => {
                if (orbit) orbit.visible = show;
            });
        }
        
        function toggleNEOOrbits() {
            const show = document.getElementById('show-neo-orbits').checked;
            neoOrbits.forEach(orbit => {
                if (orbit) orbit.visible = show;
            });
        }
        
        function toggleLabels() {
            const show = document.getElementById('show-labels').checked;
            labels.forEach(label => {
                if (label) label.visible = show;
            });
        }
        
        function closeNEOPanel() {
            document.getElementById('neo-info-panel').classList.add('hidden');
        }
        
        function showNEOInfo(data) {
            const panel = document.getElementById('neo-info-panel');
            panel.classList.remove('hidden');
            
            document.getElementById('neo-info-name').textContent = data.name;
            
            const hazardDiv = document.getElementById('neo-info-hazard');
            if (data.is_potentially_hazardous) {
                hazardDiv.textContent = '‚ö†Ô∏è POTENCIALMENTE PELIGROSO';
                hazardDiv.className = 'mb-3 px-3 py-1 rounded-full text-center text-sm bg-red-500/30 text-red-400';
            } else {
                hazardDiv.textContent = '‚úÖ SEGURO';
                hazardDiv.className = 'mb-3 px-3 py-1 rounded-full text-center text-sm bg-green-500/30 text-green-400';
            }
            
            const diameter = data.estimated_diameter_max_km 
                ? `${(data.estimated_diameter_max_km * 1000).toFixed(0)} m` 
                : '--';
            document.getElementById('neo-info-diameter').textContent = diameter;
            
            if (data.close_approaches && data.close_approaches[0]) {
                const approach = data.close_approaches[0];
                document.getElementById('neo-info-velocity').textContent = 
                    `${(approach.velocity_kmh / 1000).toFixed(1)} km/s`;
                document.getElementById('neo-info-distance').textContent = 
                    `${(approach.distance_km / 1000000).toFixed(2)} M km`;
            }
        }
        
        // Raycaster for clicking on objects
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        document.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(neoObjects);
            
            if (intersects.length > 0) {
                const neo = intersects[0].object;
                showNEOInfo(neo.userData);
            }
        });
        
        // Initialize
        init();
    </script>
</body>
</html>
